{% extends "base.html" %}

{% block title %}Query {{ query.id }}{% endblock %}

{% block content %}
<div class="card">
    <h2>{{ query.name }}</h2>
    <p class="muted">
        Search term: <code>{{ query.search_term }}</code><br>
        Query ID: {{ query.id }} â€¢ Created: {{ query.created_at }}
    </p>
</div>

<div class="card">
    <h3>Sold Items ({{ items|length }})</h3>

    {% if items %}
        <table>
            <thead>
            <tr>
                <th>Ended</th>
                <th>Title</th>
                <th>Price</th>
                <th>Cond.</th>
                <th>Type</th>
                <th>Seller</th>
                <th>Bids</th>
            </tr>
            </thead>
            <tbody>
            {% for item in items %}
                <tr>
                    <td>
                        {% if item.end_time %}
                            {{ item.end_time }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if item.view_url %}
                            <a href="{{ item.view_url }}" target="_blank" rel="noopener noreferrer">
                                {{ item.title }}
                            </a>
                        {% else %}
                            {{ item.title }}
                        {% endif %}
                    </td>
                    <td>
                        {% if item.total_price_est %}
                            {{ item.total_price_est }} {{ item.currency }}
                        {% elif item.price %}
                            {{ item.price }} {{ item.currency }}
                        {% else %}
                            -
                        {% endif %}
                        {% if item.shipping_cost %}
                            <span class="muted">(+{{ item.shipping_cost }} ship)</span>
                        {% endif %}
                    </td>
                    <td>{{ item.condition or "-" }}</td>
                    <td>{{ item.listing_type or "-" }}</td>
                    <td>
                        {% if item.seller_username %}
                            {{ item.seller_username }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>{{ item.bid_count if item.bid_count is not none else "-" }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No items found yet for this query.</p>
    {% endif %}
</div>
{% endblock %}

